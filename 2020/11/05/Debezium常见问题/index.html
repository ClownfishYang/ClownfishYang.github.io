<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-my.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-my.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-my.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.min.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"clownfishyang.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="记录Debezium使用过程中遇到的一些常见问题，后续也会持续更新。">
<meta property="og:type" content="article">
<meta property="og:title" content="Debezium常见问题">
<meta property="og:url" content="https://clownfishyang.github.io/2020/11/05/Debezium%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/index.html">
<meta property="og:site_name" content="ClownfishYang Blog">
<meta property="og:description" content="记录Debezium使用过程中遇到的一些常见问题，后续也会持续更新。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-11-05T03:17:25.000Z">
<meta property="article:modified_time" content="2020-11-13T02:25:37.453Z">
<meta property="article:author" content="ClownfishYang">
<meta property="article:tag" content="Debezium">
<meta property="article:tag" content="Mysql">
<meta property="article:tag" content="binlog">
<meta property="article:tag" content="实时同步">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://clownfishyang.github.io/2020/11/05/Debezium%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Debezium常见问题 | ClownfishYang Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ClownfishYang Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/ClownfishYang" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://clownfishyang.github.io/2020/11/05/Debezium%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar-my.jpg">
      <meta itemprop="name" content="ClownfishYang">
      <meta itemprop="description" content="须知少时凌云志，曾许人间第一流。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ClownfishYang Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Debezium常见问题<a href="https://github.com/ClownfishYang/ClownfishYang.github.io/tree/master/source/_posts/Debezium%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pencil-alt"></i></a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-05 11:17:25" itemprop="dateCreated datePublished" datetime="2020-11-05T11:17:25+08:00">2020-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-13 10:25:37" itemprop="dateModified" datetime="2020-11-13T10:25:37+08:00">2020-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>20k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>19 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>记录Debezium使用过程中遇到的一些常见问题，后续也会持续更新。</p>
<a id="more"></a>

<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="Mysql-binlog-文件清理"><a href="#Mysql-binlog-文件清理" class="headerlink" title="Mysql binlog 文件清理"></a>Mysql binlog 文件清理</h3><p>Debezium 同步Mysql依赖于binlog文件，<code>Debezium Mysql</code>会将binlog事件转换为Debezium更改事件并将这些事件记录到Kafka中，这就是<code>Debezium Mysql</code>的快照(snapshots)。<br>当connector 异常重启后，会执行<a href="https://debezium.io/documentation/reference/1.3/connectors/mysql.html#how-the-mysql-connector-performs-database-snapshots_debezium">快照恢复</a>：</p>
<ol>
<li>以可重复的读取语义启动事务，确保针对一致性快照中完成事务的所有后续读取操作；</li>
<li>读取当前serverName记录binlog的偏移量；</li>
<li>从偏移量位置开始读取允许的数据库和表的schema语句；</li>
<li>将DDL修改写入到schema修改的topic；</li>
<li>扫描数据表，并为每行数据创建相关联的topic；</li>
<li>提交事务，释放锁；</li>
<li>记录事务完成的偏移量到快照；</li>
</ol>
<p>当<code>Debezium Mysql Connector</code>停止时间过长导致binlog文件过期被清理或者磁盘紧张被清理时，Connector 记录的最后偏移量可能会丢失。<br>主要异常信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[2020-11-04 10:29:21,539] INFO Kafka version: 2.4.1 (org.apache.kafka.common.utils.AppInfoParser:117)</span><br><span class="line">[2020-11-04 10:29:21,539] INFO Kafka commitId: c57222ae8cd7866b (org.apache.kafka.common.utils.AppInfoParser:118)</span><br><span class="line">[2020-11-04 10:29:21,539] INFO Kafka startTimeMs: 1604485761539 (org.apache.kafka.common.utils.AppInfoParser:119)</span><br><span class="line">[2020-11-04 10:29:21,540] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Subscribed to topic(s): dbhistory_topic (org.apache.kafka.clients.consumer.KafkaConsumer:969)</span><br><span class="line">[2020-11-04 10:29:21,546] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Cluster ID: erxHIDoJRXGAjZ0AujKkKA (org.apache.kafka.clients.Metadata:259)</span><br><span class="line">[2020-11-04 10:29:21,547] INFO Database history topic &#39;dbhistory_topic&#39; has correct settings (io.debezium.relational.history.KafkaDatabaseHistory:440)</span><br><span class="line">[2020-11-04 10:29:21,548] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Discovered group coordinator 172.26.77.29:9092 (id: 2147483646 rack: null) (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:756)</span><br><span class="line">[2020-11-04 10:29:21,549] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] (Re-)joining group (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:533)</span><br><span class="line">[2020-11-04 10:29:21,552] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] (Re-)joining group (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:533)</span><br><span class="line">[2020-11-04 10:29:21,555] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Finished assignment for group at generation 1: &#123;dbhistory-b9169794-6a9c-4d16-abb2-70f291ffe28a&#x3D;Assignment(partitions&#x3D;[dbhistory_topic-0])&#125; (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator:585)</span><br><span class="line">[2020-11-04 10:29:21,556] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Successfully joined group with generation 1 (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:484)</span><br><span class="line">[2020-11-04 10:29:21,557] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Adding newly assigned partitions: dbhistory_topic-0 (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator:267)</span><br><span class="line">[2020-11-04 10:29:21,558] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Found no committed offset for partition dbhistory_topic-0 (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator:1241)</span><br><span class="line">[2020-11-04 10:29:21,559] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Resetting offset for partition dbhistory_topic-0 to offset 0. (org.apache.kafka.clients.consumer.internals.SubscriptionState:381)</span><br><span class="line">[2020-11-04 10:29:22,105] INFO [Worker clientId&#x3D;connect-1, groupId&#x3D;realtime-cluster] Tasks [49_gb_soa_prd_mysql_gb_s01.aws-virginia-1.hq_3306_obs_gb-0] configs updated (org.apache.kafka.connect.runtime.distributed.DistributedHerder:1411)</span><br><span class="line">[2020-11-04 10:29:22,105] INFO [Worker clientId&#x3D;connect-1, groupId&#x3D;realtime-cluster] Handling task config update by restarting tasks [49_gb_soa_prd_mysql_gb_s01.aws-virginia-1.hq_3306_obs_gb-0] (org.apache.kafka.connect.runtime.distributed.DistributedHerder:574)</span><br><span class="line">[2020-11-04 10:29:22,105] INFO Stopping task 49_gb_soa_prd_mysql_gb_s01.aws-virginia-1.hq_3306_obs_gb-0 (org.apache.kafka.connect.runtime.Worker:704)</span><br><span class="line">[2020-11-04 10:29:24,094] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Revoke previously assigned partitions dbhistory_topic-0 (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator:286)</span><br><span class="line">[2020-11-04 10:29:24,094] INFO [Consumer clientId&#x3D;dbhistory, groupId&#x3D;dbhistory] Member dbhistory-b9169794-6a9c-4d16-abb2-70f291ffe28a sending LeaveGroup request to coordinator 172.26.77.29:9092 (id: 2147483646 rack: null) due to the consumer is being closed (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:916)</span><br><span class="line">[2020-11-04 10:29:24,096] INFO Finished database history recovery of 3548 change(s) in 2559 ms (io.debezium.relational.history.DatabaseHistoryMetrics:119)</span><br><span class="line">[2020-11-04 10:29:24,099] INFO Step 0: Get all known binlogs from MySQL (io.debezium.connector.mysql.MySqlConnectorTask:551)</span><br><span class="line">[2020-11-04 10:29:24,100] INFO Connector requires binlog file &#39;binlog.000602&#39;, but MySQL only has binlog.000998, binlog.000999, binlog.001000, binlog.001001, binlog.001002, binlog.001003, binlog.001004, binlog.001005, binlog.001006, binlog.001007, binlog.001008, binlog.001009, binlog.001010, binlog.001011, binlog.001012, binlog.001013, binlog.001014, binlog.001015, binlog.001016 (io.debezium.connector.mysql.MySqlConnectorTask:566)</span><br><span class="line">[2020-11-04 10:29:24,101] INFO Stopping down connector (io.debezium.connector.common.BaseSourceTask:187)</span><br><span class="line">[2020-11-04 10:29:24,101] INFO Stopping MySQL connector task (io.debezium.connector.mysql.MySqlConnectorTask:458)</span><br><span class="line">[2020-11-04 10:29:24,101] INFO WorkerSourceTask&#123;id&#x3D;49_gb_soa_prd_mysql_gb_s01.aws-virginia-1.hq_3306_obs_gb-0&#125; Committing offsets (org.apache.kafka.connect.runtime.WorkerSourceTask:416)</span><br><span class="line">[2020-11-04 10:29:24,101] INFO WorkerSourceTask&#123;id&#x3D;49_gb_soa_prd_mysql_gb_s01.aws-virginia-1.hq_3306_obs_gb-0&#125; flushing 0 outstanding messages for offset commit (org.apache.kafka.connect.runtime.WorkerSourceTask:433)</span><br><span class="line">[2020-11-04 10:29:24,101] ERROR WorkerSourceTask&#123;id&#x3D;49_gb_soa_prd_mysql_gb_s01.aws-virginia-1.hq_3306_obs_gb-0&#125; Task threw an uncaught and unrecoverable exception (org.apache.kafka.connect.runtime.WorkerTask:179)</span><br><span class="line">org.apache.kafka.connect.errors.ConnectException: The connector is trying to read binlog starting at binlog file &#39;binlog.000602&#39;, pos&#x3D;457725550, skipping 0 events plus 0 rows, but this is no longer available on the server. Reconfigure the connector to use a snapshot when needed.</span><br><span class="line">	at io.debezium.connector.mysql.MySqlConnectorTask.start(MySqlConnectorTask.java:133)</span><br><span class="line">	at io.debezium.connector.common.BaseSourceTask.start(BaseSourceTask.java:101)</span><br><span class="line">	at org.apache.kafka.connect.runtime.WorkerSourceTask.execute(WorkerSourceTask.java:208)</span><br><span class="line">	at org.apache.kafka.connect.runtime.WorkerTask.doRun(WorkerTask.java:177)</span><br><span class="line">	at org.apache.kafka.connect.runtime.WorkerTask.run(WorkerTask.java:227)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:745)</span><br><span class="line">[2020-11-04 10:29:24,102] ERROR WorkerSourceTask&#123;id&#x3D;49_gb_soa_prd_mysql_gb_s01.aws-virginia-1.hq_3306_obs_gb-0&#125; Task is being killed and will not recover until manually restarted (org.apache.kafka.connect.runtime.WorkerTask:180)</span><br></pre></td></tr></table></figure>
<p>从异常信息来看，确实是因为binlog文件被清理导致快照记录的偏移量是丢失了，debezium有关于该问题谈论：</p>
<ol>
<li><a href="https://groups.google.com/g/debezium/c/di3jWxMzq9c">debezium unable to start if the binlog is purged</a></li>
<li><a href="https://gitter.im/debezium/user?at=5d1dde6626206b667c89e0c4">Resume Debezium MySQL connector</a></li>
</ol>
<p>这问题确实比较麻烦，最简单方式是使用一个新的serverName重新建立一个新的connector，但是问题就是topicName是跟serverName生成的，那说明后续处理topic的程序就需要改动。</p>
<p><code>Debezium Mysql</code>定义了几种快照模式：</p>
<table>
<thead>
<tr>
<th align="left">快照模式</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">initial(默认)</td>
<td align="left">仅在没有为serverName记录偏移量时才会生产快照</td>
</tr>
<tr>
<td align="left">when_needed</td>
<td align="left">在必要时运行快照，没有偏移量或者偏移量不可用时</td>
</tr>
<tr>
<td align="left">never</td>
<td align="left">不使用快照，并且首次启动时，从binlog的起始偏移量开始读取</td>
</tr>
<tr>
<td align="left">schema_only</td>
<td align="left">不需要保留数据的一致性快照，只需要保留结构的快照</td>
</tr>
<tr>
<td align="left">schema_only_recovery</td>
<td align="left">当记录现有偏移量的topic不存在时，从当前binlog的起始偏移量开始读取恢复</td>
</tr>
</tbody></table>
<p>如果使用的是<code>schema_only</code>或<code>schema_only_recovery</code>模式，能够使用<code>when_needed</code>进行恢复，但是中间丢失的binlog数据也会丢失，最好是在使用<code>when_needed</code>前先进行全量恢复使其保持数据一致性。<br>如果使用的其他模式，那么只能手动修改记录的偏移量，虽然官网提供了<a href="https://debezium.io/documentation/faq/#how_to_change_the_offsets_of_the_source_database">how_to_change_the_offsets_of_the_source_database</a>的教程，但修改起来还是很麻烦。</p>
<p>手动修改偏移量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 找到offset.storage的配置(kafka-connector配置文件)</span><br><span class="line">offset.storage.topic&#x3D;realtime-connect-offsets</span><br><span class="line">offset.storage.replication.factor&#x3D;3</span><br><span class="line">offset.storage.partitions&#x3D;2</span><br><span class="line"></span><br><span class="line"># 找到bootstrap.servers</span><br><span class="line">bootstrap.servers&#x3D;localhost:9092,localhost:9093,localhost:9094</span><br><span class="line"></span><br><span class="line"># offset.storage.topic中的消息格式</span><br><span class="line">[&quot;debezium connector name&quot;,&#123;&quot;server&quot;:&quot;database.server.name&quot;&#125;], &#123;&quot;ts_sec&quot;:当前时间戳,&quot;file&quot;:&quot;binlog fileName&quot;,&quot;pos&quot;:偏移量,&quot;row&quot;:1,&quot;server_id&quot;:server id,&quot;event&quot;:2&#125;</span><br><span class="line"></span><br><span class="line"># 向offset.storage.topic中生产一条消息</span><br><span class="line"># 因为消息格式为key:value，运行producer时必须加上parse.key和key.separator属性</span><br><span class="line">kafka-console-producer.sh --broker-list localhost:9092,localhost:9093,localhost:9094 --topic topic-name --property &quot;parse.key&#x3D;true&quot; --property &quot;key.separator&#x3D;:&quot;</span><br><span class="line"># producer启动后生产消息</span><br><span class="line">[\&quot;mysql_test_name\&quot;,&#123;\&quot;server\&quot;:\&quot;mysql_test\&quot;&#125;]:&#123;\&quot;ts_sec\&quot;:1605149663000,\&quot;file\&quot;:\&quot;binlog.000560\&quot;,\&quot;pos\&quot;:232604132,\&quot;row\&quot;:1,\&quot;server_id\&quot;:572,\&quot;event\&quot;:2&#125;</span><br></pre></td></tr></table></figure>
<p>修改完成后，重新启动connector就会从修改的binlog pos开始读取，但是中间的数据依旧会丢失。</p>
<h3 id="Mysql-主库磁盘不足导致binlog不完整"><a href="#Mysql-主库磁盘不足导致binlog不完整" class="headerlink" title="Mysql 主库磁盘不足导致binlog不完整"></a>Mysql 主库磁盘不足导致binlog不完整</h3><p>出现binlog文件被删除的告警错误，发现Connector停止时间才八个小时，而binlog存储的还有24小时，错误信息大致如下，调整了部分信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[2020-11-11 15:15:20,692] INFO WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; Committing offsets (org.apache.kafka.connect.runtime.WorkerSourceTask:416)</span><br><span class="line">[2020-11-11 15:15:20,693] INFO WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; flushing 0 outstanding messages for offset commit (org.apache.kafka.connect.runtime.WorkerSourceTask:433)</span><br><span class="line">[2020-11-11 15:15:20,693] WARN Couldn&#39;t commit processed log positions with the source database due to a concurrent connector shutdown or restart (io.debezium.connector.common.BaseSourceTask:238)</span><br><span class="line">[2020-11-11 15:15:20,709] INFO WorkerSourceTask&#123;id&#x3D;mysql_connector_test_2-0&#125; Committing offsets (org.apache.kafka.connect.runtime.WorkerSourceTask:416)</span><br><span class="line">[2020-11-11 15:15:20,709] INFO WorkerSourceTask&#123;id&#x3D;mysql_connector_test_2-0&#125; flushing 0 outstanding messages for offset commit (org.apache.kafka.connect.runtime.WorkerSourceTask:433)</span><br><span class="line">[2020-11-11 15:15:20,709] WARN Couldn&#39;t commit processed log positions with the source database due to a concurrent connector shutdown or restart (io.debezium.connector.common.BaseSourceTask:238)</span><br><span class="line">[2020-11-11 15:15:21,605] INFO [Consumer clientId&#x3D;mysql_connector_test_2-dbhistory, groupId&#x3D;mysql_connector_test_2-dbhistory] Revoke previously assigned partitions ddlhistory.sync_36-0 (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator:286)</span><br><span class="line">[2020-11-11 15:15:21,605] INFO [Consumer clientId&#x3D;mysql_connector_test_2-dbhistory, groupId&#x3D;mysql_connector_test_2-dbhistory] Member mysql_connector_test_2-dbhistory-4acebc73-3006-48f7-99d1-0c80976ba224 sending LeaveGroup request to coordinator 172.26.77.37:9092 (id: 2147483644 rack: null) due to the consumer is being closed (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:916)</span><br><span class="line">[2020-11-11 15:15:21,610] INFO Finished database history recovery of 5009 change(s) in 9828 ms (io.debezium.relational.history.DatabaseHistoryMetrics:119)</span><br><span class="line">[2020-11-11 15:15:21,931] INFO Step 0: Get all known binlogs from MySQL (io.debezium.connector.mysql.MySqlConnectorTask:551)</span><br><span class="line">[2020-11-11 15:15:21,936] INFO MySQL has the binlog file &#39;binlog.000247&#39; required by the connector (io.debezium.connector.mysql.MySqlConnectorTask:570)</span><br><span class="line">[2020-11-11 15:15:21,963] INFO Requested thread factory for connector MySqlConnector, id &#x3D; sync_36 named &#x3D; binlog-client (io.debezium.util.Threads:270)</span><br><span class="line">[2020-11-11 15:15:22,030] INFO Creating thread debezium-mysqlconnector-sync_36-binlog-client (io.debezium.util.Threads:287)</span><br><span class="line">[2020-11-11 15:15:22,034] INFO Creating thread debezium-mysqlconnector-sync_36-binlog-client (io.debezium.util.Threads:287)</span><br><span class="line">[2020-11-11 15:15:22,169] INFO Connected to MySQL binlog at mysql:3306, starting at binlog file &#39;binlog.000247&#39;, pos&#x3D;218926431, skipping 3 events plus 1 rows (io.debezium.connector.mysql.BinlogReader:1111)</span><br><span class="line">[2020-11-11 15:15:22,170] INFO Creating thread debezium-mysqlconnector-sync_36-binlog-client (io.debezium.util.Threads:287)</span><br><span class="line">[2020-11-11 15:15:22,171] INFO Waiting for keepalive thread to start (io.debezium.connector.mysql.BinlogReader:412)</span><br><span class="line">[2020-11-11 15:15:22,172] INFO Keepalive thread is running (io.debezium.connector.mysql.BinlogReader:419)</span><br><span class="line">[2020-11-11 15:15:22,273] INFO WorkerSourceTask&#123;id&#x3D;mysql_connector_test_2-0&#125; Source task finished initialization and start (org.apache.kafka.connect.runtime.WorkerSourceTask:209)</span><br><span class="line">[2020-11-11 15:15:24,994] INFO [Consumer clientId&#x3D;mysql_connector_test_1-dbhistory, groupId&#x3D;mysql_connector_test_1-dbhistory] Revoke previously assigned partitions ddlhistory.sync_39-0 (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator:286)</span><br><span class="line">[2020-11-11 15:15:24,994] INFO [Consumer clientId&#x3D;mysql_connector_test_1-dbhistory, groupId&#x3D;mysql_connector_test_1-dbhistory] Member mysql_connector_test_1-dbhistory-3f3de8fa-2a48-473f-9484-b7d323b55972 sending LeaveGroup request to coordinator 172.26.77.110:9092 (id: 2147483645 rack: null) due to the consumer is being closed (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:916)</span><br><span class="line">[2020-11-11 15:15:24,998] INFO Finished database history recovery of 8384 change(s) in 13322 ms (io.debezium.relational.history.DatabaseHistoryMetrics:119)</span><br><span class="line">[2020-11-11 15:15:25,102] INFO Step 0: Get all known binlogs from MySQL (io.debezium.connector.mysql.MySqlConnectorTask:551)</span><br><span class="line">[2020-11-11 15:15:25,107] INFO Connector requires binlog file &#39;binlog.000559&#39;, but MySQL only has binlog.000384, binlog.000385, binlog.000386, binlog.000387, binlog.000388, binlog.000389, binlog.000390, binlog.000391, binlog.000392, binlog.000393, binlog.000394, binlog.000395, binlog.000396, binlog.000397, binlog.000398, binlog.000399, binlog.000400, binlog.000401, binlog.000402, binlog.000403, binlog.000404, binlog.000405, binlog.000406, binlog.000407, binlog.000408, binlog.000409, binlog.000410, binlog.000411, binlog.000412, binlog.000413, binlog.000414, binlog.000415, binlog.000416, binlog.000417, binlog.000418, binlog.000419, binlog.000420, binlog.000421, binlog.000422, binlog.000423, binlog.000424, binlog.000425, binlog.000426, binlog.000427, binlog.000428, binlog.000429, binlog.000430, binlog.000431, binlog.000432, binlog.000433, binlog.000434, binlog.000435, binlog.000436, binlog.000437, binlog.000438, binlog.000439, binlog.000440, binlog.000441, binlog.000442, binlog.000443, binlog.000444, binlog.000445, binlog.000446, binlog.000447, binlog.000448, binlog.000449, binlog.000450, binlog.000451, binlog.000452, binlog.000453, binlog.000454, binlog.000455, binlog.000456, binlog.000457, binlog.000458, binlog.000459, binlog.000460, binlog.000461, binlog.000462, binlog.000463, binlog.000464, binlog.000465, binlog.000466, binlog.000467, binlog.000468, binlog.000469, binlog.000470, binlog.000471, binlog.000472, binlog.000473, binlog.000474, binlog.000475, binlog.000476, binlog.000477, binlog.000478, binlog.000479, binlog.000480, binlog.000481, binlog.000482, binlog.000483, binlog.000484, binlog.000485, binlog.000486, binlog.000487, binlog.000488, binlog.000489, binlog.000490, binlog.000491, binlog.000492, binlog.000493, binlog.000494, binlog.000495, binlog.000496, binlog.000497, binlog.000498, binlog.000499, binlog.000500, binlog.000501, binlog.000502, binlog.000503, binlog.000504, binlog.000505, binlog.000506, binlog.000507, binlog.000508, binlog.000509, binlog.000510, binlog.000511, binlog.000512, binlog.000513, binlog.000514, binlog.000515, binlog.000516, binlog.000517, binlog.000518, binlog.000519, binlog.000520, binlog.000521, binlog.000522, binlog.000523, binlog.000524, binlog.000525, binlog.000526, binlog.000527, binlog.000528, binlog.000529, binlog.000530, binlog.000531, binlog.000532, binlog.000533, binlog.000534, binlog.000535, binlog.000536, binlog.000537, binlog.000538, binlog.000539, binlog.000540, binlog.000541, binlog.000542, binlog.000543, binlog.000544, binlog.000545, binlog.000546, binlog.000547, binlog.000548, binlog.000549, binlog.000550, binlog.000551, binlog.000552, binlog.000553, binlog.000554, binlog.000555, binlog.000556, binlog.000557, binlog.000558 (io.debezium.connector.mysql.MySqlConnectorTask:566)</span><br><span class="line">[2020-11-11 15:15:25,108] INFO Stopping down connector (io.debezium.connector.common.BaseSourceTask:187)</span><br><span class="line">[2020-11-11 15:15:25,108] INFO Stopping MySQL connector task (io.debezium.connector.mysql.MySqlConnectorTask:458)</span><br><span class="line">[2020-11-11 15:15:25,108] INFO WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; Committing offsets (org.apache.kafka.connect.runtime.WorkerSourceTask:416)</span><br><span class="line">[2020-11-11 15:15:25,108] INFO WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; flushing 0 outstanding messages for offset commit (org.apache.kafka.connect.runtime.WorkerSourceTask:433)</span><br><span class="line">[2020-11-11 15:15:25,109] ERROR WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; Task threw an uncaught and unrecoverable exception (org.apache.kafka.connect.runtime.WorkerTask:179)</span><br><span class="line">org.apache.kafka.connect.errors.ConnectException: The connector is trying to read binlog starting at binlog file &#39;binlog.000559&#39;, pos&#x3D;271193190, skipping 3 events plus 1 rows, but this is no longer available on the server. Reconfigure the connector to use a snapshot when needed.</span><br><span class="line">	at io.debezium.connector.mysql.MySqlConnectorTask.start(MySqlConnectorTask.java:133)</span><br><span class="line">	at io.debezium.connector.common.BaseSourceTask.start(BaseSourceTask.java:101)</span><br><span class="line">	at org.apache.kafka.connect.runtime.WorkerSourceTask.execute(WorkerSourceTask.java:208)</span><br><span class="line">	at org.apache.kafka.connect.runtime.WorkerTask.doRun(WorkerTask.java:177)</span><br><span class="line">	at org.apache.kafka.connect.runtime.WorkerTask.run(WorkerTask.java:227)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:745)</span><br><span class="line">[2020-11-11 15:15:25,110] ERROR WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; Task is being killed and will not recover until manually restarted (org.apache.kafka.connect.runtime.WorkerTask:180)</span><br><span class="line">[2020-11-11 15:15:25,110] INFO Connector has already been stopped (io.debezium.connector.common.BaseSourceTask:179)</span><br><span class="line">[2020-11-11 15:15:25,110] INFO [Producer clientId&#x3D;connector-producer-mysql_connector_test_1-0] Closing the Kafka producer with timeoutMillis &#x3D; 30000 ms. (org.apache.kafka.clients.producer.KafkaProducer:1183)[2020-11-11 15:15:30,697] INFO WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; Committing offsets (org.apache.kafka.connect.runtime.WorkerSourceTask:416)</span><br></pre></td></tr></table></figure>
<p>有个关键的信息是，Debezium保存的是binlog.000559，而主库却只有385-558的binlog，猜测可能跟binlog清理设置有关系。<br>将快照模式依次调整为<code>schema_only_recovery</code>和<code>when_needed</code>都报出了相同的错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2020-11-12 01:51:06,372] ERROR WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; Task threw an uncaught and unrecoverable exception (org.apache.kafka.connect.runtime.WorkerTask:179)</span><br><span class="line">org.apache.kafka.connect.errors.ConnectException: binlog truncated in the middle of event; consider out of disk space on master; the first event &#39;binlog.000559&#39; at 271193190, the last event read from &#39;&#x2F;data&#x2F;dbdata&#x2F;mysqllog&#x2F;binlog&#x2F;binlog.000559&#39; at 271193190, the last</span><br><span class="line"> byte read from &#39;&#x2F;data&#x2F;dbdata&#x2F;mysqllog&#x2F;binlog&#x2F;binlog.000559&#39; at 271193209. Error code: 1236; SQLSTATE: HY000.</span><br><span class="line">        at io.debezium.connector.mysql.AbstractReader.wrap(AbstractReader.java:230)</span><br><span class="line">        at io.debezium.connector.mysql.AbstractReader.failed(AbstractReader.java:196)</span><br><span class="line">        at io.debezium.connector.mysql.BinlogReader$ReaderThreadLifecycleListener.onCommunicationFailure(BinlogReader.java:1125)</span><br><span class="line">        at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets(BinaryLogClient.java:985)</span><br><span class="line">        at com.github.shyiko.mysql.binlog.BinaryLogClient.connect(BinaryLogClient.java:581)</span><br><span class="line">        at com.github.shyiko.mysql.binlog.BinaryLogClient$7.run(BinaryLogClient.java:860)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line">Caused by: com.github.shyiko.mysql.binlog.network.ServerException: binlog truncated in the middle of event; consider out of disk space on master; the first event &#39;binlog.000559&#39; at 271193190, the last event read from &#39;&#x2F;data&#x2F;dbdata&#x2F;mysqllog&#x2F;binlog&#x2F;binlog.000559&#39; at 27</span><br><span class="line">1193190, the last byte read from &#39;&#x2F;data&#x2F;dbdata&#x2F;mysqllog&#x2F;binlog&#x2F;binlog.000559&#39; at 271193209.</span><br><span class="line">        at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets(BinaryLogClient.java:949)</span><br><span class="line">        ... 3 more</span><br><span class="line">[2020-11-12 01:51:06,372] ERROR WorkerSourceTask&#123;id&#x3D;mysql_connector_test_1-0&#125; Task is being killed and will not recover until manually restarted (org.apache.kafka.connect.runtime.WorkerTask:180)</span><br><span class="line">[2020-11-12 01:51:06,372] INFO Stopping down connector (io.debezium.connector.common.BaseSourceTask:187)</span><br><span class="line">[2020-11-12 01:51:06,372] INFO Stopping MySQL connector task (io.debezium.connector.mysql.MySqlConnectorTask:458)</span><br></pre></td></tr></table></figure>
<p>主库是存在binlog.000559这个文件的，但是可能由于主库磁盘存储不足导致日志记录不完整，被截断了。<br>通过<a href="https://www.percona.com/blog/2014/10/08/mysql-replication-got-fatal-error-1236-causes-and-cures/">MySQL Replication: ‘Got fatal error 1236’ causes and cures</a><br>和<a href="http://blog.itpub.net/22664653/viewspace-1714269/">Got fatal error 1236原因</a>了解到，只能将binlog指向下一个可用的binlog file，所以只能通过<code>手动修改偏移量</code>的方式解决。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://debezium.io/documentation/reference/1.3/connectors/mysql.html"><i class="fas fa-paperclip"></i> debezium documentation</a><br><a href="https://groups.google.com/g/debezium/c/di3jWxMzq9c"><i class="fas fa-paperclip"></i> debezium unable to start if the binlog is purged</a><br><a href="https://gitter.im/debezium/user?at=5d1dde6626206b667c89e0c4"><i class="fas fa-paperclip"></i> Resume Debezium MySQL connector</a><br><a href="https://debezium.io/documentation/faq/#how_to_change_the_offsets_of_the_source_database"><i class="fas fa-paperclip"></i> how_to_change_the_offsets_of_the_source_database</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Debezium/" rel="tag"><i class="fa fa-tag"></i> Debezium</a>
              <a href="/tags/Mysql/" rel="tag"><i class="fa fa-tag"></i> Mysql</a>
              <a href="/tags/binlog/" rel="tag"><i class="fa fa-tag"></i> binlog</a>
              <a href="/tags/%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/" rel="tag"><i class="fa fa-tag"></i> 实时同步</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/03/Hexo%20Next%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E9%97%AE%E9%A2%98/" rel="prev" title="Hexo Next搭建博客问题">
      <i class="fa fa-chevron-left"></i> Hexo Next搭建博客问题
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/10/hello-world/" rel="next" title="Hello World">
      Hello World <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql-binlog-%E6%96%87%E4%BB%B6%E6%B8%85%E7%90%86"><span class="nav-number">1.1.</span> <span class="nav-text">Mysql binlog 文件清理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql-%E4%B8%BB%E5%BA%93%E7%A3%81%E7%9B%98%E4%B8%8D%E8%B6%B3%E5%AF%BC%E8%87%B4binlog%E4%B8%8D%E5%AE%8C%E6%95%B4"><span class="nav-number">1.2.</span> <span class="nav-text">Mysql 主库磁盘不足导致binlog不完整</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="nav-number">2.</span> <span class="nav-text">参考文章</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ClownfishYang"
      src="/images/avatar-my.jpg">
  <p class="site-author-name" itemprop="name">ClownfishYang</p>
  <div class="site-description" itemprop="description">须知少时凌云志，曾许人间第一流。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ClownfishYang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ClownfishYang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ClownfishYang@163.com" title="E-Mail → mailto:ClownfishYang@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ClownfishYang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">41k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">37 分钟</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
